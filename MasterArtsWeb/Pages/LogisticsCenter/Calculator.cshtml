@page
@model MasterArtsWeb.Pages.LogisticsCenter.CalculatorModel

<h3 class="contact adjusted-anchor-2" id="contact-id">
    Shipment-Calculator
</h3>
<div style="margin-top:100px;">
    <a href="/LogisticsCenter/ShipmentCalculator#contact-id" class="cta-button">Back</a>
</div>
<form method="post" id="languageForm">
    <div id="language-switch">
        <button type="submit" class="l-btn">SWE/ENG</button>
    </div>
</form>
    <div class="section">
    @if (@Model.CurrentLanguage == "sv")
    {
        <p>
            1:6, 1:5, 1:4, 1:3, 1:2 – Dessa förhållanden indikerar lägre densitet, vilket innebär att godset är relativt lätt i förhållande till sin volym. Exempelvis skulle ett förhållande på 1:6 kunna representera mycket lätt, men skrymmande gods, som isoleringsmaterial eller stora plastkomponenter. Ju högre den andra siffran i förhållandet, desto mer tar godset upp utrymme jämfört med dess vikt.

            1:1 – Detta är ett förhållande där vikten och volymen är lika i termer av densitet. Detta skulle kunna representera mer tätt packade eller solidare material, där vikten direkt motsvarar volymen på ett jämnt sätt.

            1:7, 1:8, 1:9, 1:10 – Dessa värden indikerar ännu lägre densiteter och är typiska för extremt lätta och skrymmande föremål. Exempel på sådana föremål kan inkludera stora förpackningar av fjädrar eller stora plastbollar. För dessa förhållanden tar godset upp en betydande mängd utrymme i förhållande till dess lilla vikt.
        </p>
    }
    else
    {
        <p>
            1:6, 1:5, 1:4, 1:3, 1:2 – These ratios indicate lower density, meaning the goods are relatively light in relation to their volume. For example, a ratio of 1:6 could represent very light but bulky goods, such as insulation materials or large plastic components. The higher the second number in the ratio, the more space the goods occupy compared to their weight.

            1:1 – This is a ratio where the weight and volume are equal in terms of density. This could represent more tightly packed or denser materials, where the weight directly corresponds to the volume in an even manner.

            1:7, 1:8, 1:9, 1:10 – These values indicate even lower densities and are typical for extremely light and bulky items. Examples of such items might include large packages of feathers or large plastic balls. For these conditions, the goods occupy a significant amount of space in relation to their small weight.
        </p>
    }
   
    </div>

@if (@Model.CurrentLanguage == "sv")
{
    <div class="calculator-container" id="mr-calc" style="margin-top:70px">
        <form id="calculator-form" class="shipment-form-2">
            <div id="density-selection">
                <label>Välj Densitet:</label>
                <select id="selectedDensity" onchange="updateResults()">
                    <option value="1:6">1:6</option>
                    <option value="1:1">1:1</option>
                    <option value="1:2">1:2</option>
                    <option value="1:3">1:3</option>
                    <option value="1:4">1:4</option>
                    <option value="1:5">1:5</option>
                    <option value="1:6">1:6</option>
                    <option value="1:7">1:7</option>
                    <option value="1:8">1:8</option>
                    <option value="1:9">1:9</option>
                    <option value="1:10">1:10</option>
                    <!-- Lägg till fler densitetsalternativ här -->
                </select>
            </div>
            <div id="items-container">
                <!-- Objekt kommer att läggas till här -->
            </div>

            <button type="button" class="btn btn-secondary" onclick="addItem()">Lägg till objekt</button>

            <div class="results-container">
                <p id="totalVolume">Total volym: 0 m³</p>
                <p id="totalVolumeWeight">Total volymvikt: 0 kg</p>
                <p id="totalActualWeight">Total faktisk vikt: 0 kg</p>
                <p id="chargeableWeight">Debiterbar vikt: 0 kg</p>
            </div>

            <button type="button" class="btn btn-secondary" onclick="resetCalculator()">Reset Calculator</button>

        </form>
    </div>
}
else
{
    <div class="calculator-container" id="mr-calc" style="margin-top:70px">
        <form id="calculator-form" class="shipment-form-2">
            <div id="density-selection">
                <label>Select Density:</label>
                <select id="selectedDensity" onchange="updateResults()">
                    <option value="1:6">1:6</option>
                    <option value="1:1">1:1</option>
                    <option value="1:2">1:2</option>
                    <option value="1:3">1:3</option>
                    <option value="1:4">1:4</option>
                    <option value="1:5">1:5</option>
                    <option value="1:6">1:6</option>
                    <option value="1:7">1:7</option>
                    <option value="1:8">1:8</option>
                    <option value="1:9">1:9</option>
                    <option value="1:10">1:10</option>
                    <!-- Lägg till fler densitetsalternativ här -->
                </select>
            </div>
            <div id="items-container">
                <!-- Objekt kommer att läggas till här -->
            </div>

            <button type="button" class="btn btn-secondary" onclick="addItem()">Add Item</button>

            <div class="results-container">
                <p id="totalVolume">Total Volume: 0 m³</p>
                <p id="totalVolumeWeight">Total Volume Weight: 0 kg</p>
                <p id="totalActualWeight">Total Actual Weight: 0 kg</p>
                <p id="chargeableWeight">Chargeable Weight: 0 kg</p>
            </div>
            <button type="button" class="btn btn-secondary" onclick="resetCalculator()">Reset Calculator</button>

        </form>
    </div>
}


    <script>
        // Funktion för att lägga till ett nytt objekt
        function addItem() {
            var container = document.getElementById("items-container");
            var index = container.children.length;

            var div = document.createElement("div");
            div.className = "shipment-item";
            div.innerHTML = `
                    <label>Length (cm):</label>
                    <input type="text" name="Items[${index}].Length" onchange="updateResults()" />

                    <label>Width (cm):</label>
                    <input type="text" name="Items[${index}].Width" onchange="updateResults()" />

                    <label>Height (cm):</label>
                    <input type="text" name="Items[${index}].Height" onchange="updateResults()" />

                    <label>Actual weight (kg):</label>
                    <input type="text" name="Items[${index}].ActualWeight" onchange="updateResults()" />

                    <label>Pieces:</label>
                    <input type="number" name="Items[${index}].Pieces" onchange="updateResults()" />
                `;

            container.appendChild(div);
        }

        // Funktion för att uppdatera resultaten baserat på inmatningar och densitet
        function updateResults() {
            var items = document.querySelectorAll('.shipment-item');
            var totalVolume = 0, totalActualWeight = 0, totalVolumeWeight = 0;

            var selectedDensityValue = document.getElementById('selectedDensity').value;
            var densityRatio = extractDensityRatio(selectedDensityValue);

            items.forEach(function (item) {
                var length = parseFloat(item.querySelector('input[name*=".Length"]').value) || 0;
                var width = parseFloat(item.querySelector('input[name*=".Width"]').value) || 0;
                var height = parseFloat(item.querySelector('input[name*=".Height"]').value) || 0;
                var actualWeight = parseFloat(item.querySelector('input[name*=".ActualWeight"]').value) || 0;
                var pieces = parseInt(item.querySelector('input[name*=".Pieces"]').value) || 1;

                var volume = (length * width * height) / 1000000;
                var volumeWeight = volume * densityRatio * 1000;

                totalVolume += volume * pieces;
                totalActualWeight += actualWeight * pieces;
                totalVolumeWeight += volumeWeight * pieces;
            });

            var chargeableWeight = Math.max(totalVolumeWeight, totalActualWeight);

            document.getElementById('totalVolume').innerText = 'Total Volume: ' + totalVolume.toFixed(2) + ' m³';
            document.getElementById('totalVolumeWeight').innerText = 'Total Volume Weight: ' + totalVolumeWeight.toFixed(2) + ' kg';
            document.getElementById('totalActualWeight').innerText = 'Total Actual Weight: ' + totalActualWeight.toFixed(2) + ' kg';
            document.getElementById('chargeableWeight').innerText = 'Chargeable Weight: ' + chargeableWeight.toFixed(2) + ' kg';
        }

        // Hjälpfunktion för att extrahera och omvandla densitetsförhållandet
        function extractDensityRatio(selectedDensity) {
            var ratio = 0.0;
            if (selectedDensity) {
                var parts = selectedDensity.split(':');
                if (parts.length === 2) {
                    var numerator = parseFloat(parts[0]);
                    var denominator = parseFloat(parts[1]);
                    if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
                        ratio = numerator / denominator;
                    }
                }
            }
            return ratio;
        }


    function resetCalculator() {
        // Återställer densitetsval till det första alternativet
        document.getElementById('selectedDensity').selectedIndex = 0;

        // Rensar alla tillagda objekt
        var container = document.getElementById("items-container");
        container.innerHTML = '';

        // Återställer resultaten till 0
        document.getElementById('totalVolume').innerText = 'Total Volume: 0 m³';
        document.getElementById('totalVolumeWeight').innerText = 'Total Volume Weight: 0 kg';
        document.getElementById('totalActualWeight').innerText = 'Total Actual Weight: 0 kg';
        document.getElementById('chargeableWeight').innerText = 'Chargeable Weight: 0 kg';
    }

    </script>


    




